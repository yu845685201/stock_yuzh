# pytdx深度调研报告

## 概述

本报告基于官方文档分析和实际接口测试，详细说明了pytdx库中每个接口的数据采集能力，包括具体的字段结构和数据来源方式。

## 数据来源分类

pytdx支持两种数据获取方式：

1. **通达信接口** - 通过网络连接通达信服务器实时获取数据
2. **通达信数据文件** - 直接读取本地通达信客户端的数据文件

---

## 一、通达信接口类

### 1. get_security_bars - 获取股票K线数据

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信接口 |
| **功能描述** | 获取股票历史K线数据，支持多种周期 |
| **参数说明** | `category`: K线类型 (0=5分钟, 1=15分钟, 2=30分钟, 3=1小时, 4=日线, 5=周线, 6=月线, 7=1分钟, 8=1分钟, 9=日线)<br>`market`: 市场 (0=深圳, 1=上海)<br>`code`: 股票代码<br>`start`: 起始位置<br>`count`: 获取数量 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 | 示例值 |
|--------|----------|------|--------|
| datetime | string | 日期时间 | "2025-12-11 15:00" |
| open | float | 开盘价 | 11.35 |
| high | float | 最高价 | 11.39 |
| low | float | 最低价 | 11.30 |
| close | float | 收盘价 | 11.37 |
| vol | float | 成交量(手) | 925261.0 |
| amount | float | 成交额(元) | 1049906240.0 |
| year | int | 年份 | 2025 |
| month | int | 月份 | 12 |
| day | int | 日期 | 11 |
| hour | int | 小时 | 15 |
| minute | int | 分钟 | 0 |

### 2. get_index_bars - 获取指数K线数据

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信接口 |
| **功能描述** | 获取指数历史K线数据 |
| **参数说明** | `category`: K线类型 (同get_security_bars)<br>`market`: 市场 (0=深圳, 1=上海)<br>`code`: 指数代码<br>`start`: 起始位置<br>`count`: 获取数量 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 | 示例值 |
|--------|----------|------|--------|
| datetime | string | 日期时间 | "2025-12-11 15:00" |
| open | float | 开盘价 | 3903.89 |
| high | float | 最高价 | 3904.96 |
| low | float | 最低价 | 3862.82 |
| close | float | 收盘价 | 3873.32 |
| vol | float | 成交量(手) | 5256586.0 |
| amount | float | 成交额(元) | 764350169088.0 |
| up_count | int | 上涨股票数 | 395 |
| down_count | int | 下跌股票数 | 1911 |
| year | int | 年份 | 2025 |
| month | int | 月份 | 12 |
| day | int | 日期 | 11 |
| hour | int | 小时 | 15 |
| minute | int | 分钟 | 0 |

### 3. get_security_quotes - 获取实时行情数据

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信接口 |
| **功能描述** | 获取股票实时行情数据，支持多只股票批量查询 |
| **参数说明** | `all_stock`: 股票列表 [(market, code), ...] |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| market | int | 市场代码 (0=深圳, 1=上海) |
| code | string | 股票代码 |
| active1 | int | 活跃股1 |
| price | float | 当前价 |
| last_close | float | 昨收价 |
| open | float | 开盘价 |
| high | float | 最高价 |
| low | float | 最低价 |
| servertime | string | 服务器时间 |
| vol | float | 总成交量 |
| cur_vol | float | 当前成交量 |
| amount | float | 总成交额 |
| s_vol | float | 卖出量 |
| b_vol | float | 买入量 |
| bid1 | float | 买一价 |
| ask1 | float | 卖一价 |
| bid_vol1 | float | 买一量 |
| ask_vol1 | float | 卖一量 |
| bid2 | float | 买二价 |
| ask2 | float | 卖二价 |
| bid_vol2 | float | 买二量 |
| ask_vol2 | float | 卖二量 |
| bid3 | float | 买三价 |
| ask3 | float | 卖三价 |
| bid_vol3 | float | 买三量 |
| ask_vol3 | float | 卖三量 |
| bid4 | float | 买四价 |
| ask4 | float | 卖四价 |
| bid_vol4 | float | 买四量 |
| ask_vol4 | float | 卖四量 |
| bid5 | float | 买五价 |
| ask5 | float | 卖五价 |
| bid_vol5 | float | 买五量 |
| ask_vol5 | float | 卖五量 |
| active2 | int | 活跃股2 |

### 4. get_security_list - 获取股票列表

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信接口 |
| **功能描述** | 获取指定市场的股票列表 |
| **参数说明** | `market`: 市场 (0=深圳, 1=上海)<br>`start`: 起始位置 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| code | string | 股票代码 |
| name | string | 股票名称 |
| volunit | int | 交易单位 |
| decimal_point | int | 小数位数 |
| pre_close | float | 昨收价 |

### 5. get_security_count - 获取股票数量

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信接口 |
| **功能描述** | 获取指定市场的股票总数量 |
| **参数说明** | `market`: 市场 (0=深圳, 1=上海) |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 | 示例值 |
|--------|----------|------|--------|
| count | int | 股票总数量 | 深圳: 22173, 上海: 26392 |

### 6. get_minute_time_data - 获取分时数据

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信接口 |
| **功能描述** | 获取当日分时数据（每分钟一条） |
| **参数说明** | `market`: 市场 (0=深圳, 1=上海)<br>`code`: 股票代码 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| price | float | 当前价格 |
| vol | float | 成交量 |

### 7. get_company_info_category - 获取公司信息分类

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信接口 |
| **功能描述** | 获取上市公司信息文件分类列表 |
| **参数说明** | `market`: 市场 (0=深圳, 1=上海)<br>`code`: 股票代码 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| name | string | 文件名称 |
| filename | string | 文件名 |
| start | int | 起始位置 |
| length | int | 文件长度 |

### 8. get_company_info_content - 获取公司信息内容

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信接口 |
| **功能描述** | 获取上市公司详细信息文件内容 |
| **参数说明** | `market`: 市场 (0=深圳, 1=上海)<br>`code`: 股票代码<br>`filename`: 文件名<br>`start`: 起始位置<br>`length`: 读取长度 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| content | string | 文件内容（文本格式） |

### 9. get_xdxr_info - 获取除权除息信息

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信接口 |
| **功能描述** | 获取股票除权除息历史信息 |
| **参数说明** | `market`: 市场 (0=深圳, 1=上海)<br>`code`: 股票代码 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| year | int | 年份 |
| month | int | 月份 |
| day | int | 日期 |
| category | string | 类别 |
| name | string | 股票名称 |
| fenhong | float | 分红(元) |
| peigujia | float | 配股价(元) |
| songzhuangu | float | 送股比例 |
| peigu | float | 配股比例 |
| suogu | float | 缩股比例 |
| panqianliutong | float | 盘前流通股 |
| panhouliutong | float | 盘后流通股 |
| qianzongguben | float | 前总股本 |
| houzongguben | float | 后总股本 |
| fenshu | float | 分数 |
| xingquanjia | float | 行权价 |

### 10. get_finance_info - 获取财务信息

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信接口 |
| **功能描述** | 获取上市公司财务数据 |
| **参数说明** | `market`: 市场 (0=深圳, 1=上海)<br>`code`: 股票代码 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| date | string | 报告日期 |
| code | string | 股票代码 |
| name | string | 股票名称 |
| mgsy | float | 每股收益(元) |
| mgxj | float | 每股现金(元) |
| mzzc | float | 每股净资产(元) |
| zgb | float | 总股本(万股) |
| ltgb | float | 流通股本(万股) |
| gdjc | float | 股东人数 |
| bdlr | float | 股东人数变化 |
| jll | float | 净利润(万元) |
| yysr | float | 营业收入(万元) |
| yyly | float | 营业利润(万元) |
| lrze | float | 利润总额(万元) |
| jzcsyl | float | 净资产收益率(%) |
| mgjzc | float | 每股净资产(元) |
| zzcsyl | float | 总资产收益率(%) |

### 11. get_block_info - 获取板块信息

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信接口 |
| **功能描述** | 获取板块分类信息及成分股 |
| **参数说明** | `blockfile`: 板块文件名 (如 'block_gn.dat')<br>`start`: 起始位置<br>`size`: 获取数量 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| blockname | string | 板块名称 |
| code | string | 股票代码 |
| name | string | 股票名称 |
| market | int | 市场代码 |

---

## 二、通达信数据文件读取类

### 1. DailyBarReader - 日线数据文件读取器

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信数据文件 |
| **功能描述** | 读取通达信日线数据文件(.day) |
| **文件路径** | `vipdoc/{market}/lday/{market}{code}.day` |
| **支持市场** | `sz`: 深圳市场, `sh`: 上海市场, `bj`: 北交所 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 | 计算方式 |
|--------|----------|------|----------|
| date | string | 日期(YYYY-MM-DD) | 从时间戳转换 |
| open | float | 开盘价 | 原始值 × 0.01 |
| high | float | 最高价 | 原始值 × 0.01 |
| low | float | 最低价 | 原始值 × 0.01 |
| close | float | 收盘价 | 原始值 × 0.01 |
| amount | float | 成交额(元) | 原始值 |
| volume | float | 成交量(手) | 原始值 × 0.01 |

#### 证券类型系数

| 证券类型 | 价格系数 | 成交量系数 | 代码规则 |
|----------|----------|------------|----------|
| SZ_A_STOCK | 0.01 | 0.01 | 00xxx, 30xxx |
| SZ_B_STOCK | 0.01 | 0.01 | 20xxx |
| SZ_INDEX | 0.01 | 1.0 | 39xxx |
| SZ_FUND | 0.001 | 0.01 | 15xxx, 16xxx |
| SZ_BOND | 0.001 | 0.01 | 10xxx-14xxx |
| SH_A_STOCK | 0.01 | 0.01 | 60xxx, 68xxx |
| SH_B_STOCK | 0.001 | 0.01 | 90xxx |
| SH_INDEX | 0.01 | 1.0 | 00xxx, 88xxx, 99xxx |
| SH_FUND | 0.001 | 1.0 | 50xxx, 51xxx |
| SH_BOND | 0.001 | 1.0 | 01xxx, 10xxx-20xxx |

### 2. MinuteBarReader - 分钟线数据文件读取器

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信数据文件 |
| **功能描述** | 读取通达信分钟线数据文件 |
| **文件路径** | 1分钟: `vipdoc/{market}/minline/{market}{code}.lc1`<br>5分钟: `vipdoc/{market}/fzline/{market}{code}.lc5` |
| **支持周期** | 1分钟(.lc1), 5分钟(.lc5) |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| datetime | string | 时间(YYYY-MM-DD HH:MM) |
| open | float | 开盘价 |
| high | float | 最高价 |
| low | float | 最低价 |
| close | float | 收盘价 |
| amount | float | 成交额(元) |
| volume | float | 成交量(手) |

### 3. GbbqReader - 股本数据文件读取器

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信数据文件 |
| **功能描述** | 读取通达信股本变化数据文件(.gbbq) |
| **文件路径** | `vipdoc/{market}/gbbq/{market}{code}.gbbq` |
| **加密方式** | 专用加密算法，需要密钥解密 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| date | string | 日期 |
| total_share | float | 总股本(万股) |
| float_share | float | 流通股本(万股) |
| state | int | 股本状态 |

### 4. BlockReader - 板块数据文件读取器

| 属性 | 值 |
|------|-----|
| **数据来源** | 通达信数据文件 |
| **功能描述** | 读取通达信板块数据文件 |
| **文件路径** | `vipdoc/{blockfile}` |
| **支持文件** | `block_gn.dat`(概念板块), `block_fg.dat`(风格板块) 等 |

#### 返回字段详细说明

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| blockname | string | 板块名称 |
| code | string | 股票代码 |
| name | string | 股票名称 |
| market | int | 市场代码 |

---

## 三、接口能力对比矩阵

| 数据类型 | 通达信接口 | 通达信文件 | 备注 |
|----------|------------|------------|------|
| **基本信息** | | | |
| 股票列表 | ✓ ✅ | ✗ ❌ | 接口方式实时性更好 |
| 股票名称 | ✓ ✅ | ✗ ❌ | 需要通过接口获取 |
| **K线数据** | | | |
| 日K线 | ✓ ✅ | ✓ ✅ | 文件方式访问更快 |
| 分钟K线 | ✓ ✅ | ✓ ✅ | 文件方式支持历史数据 |
| 周/月K线 | ✓ ✅ | ✗ ❌ | 只能通过接口获取 |
| 指数K线 | ✓ ✅ | ✗ ❌ | 只能通过接口获取 |
| **实时数据** | | | |
| 实时行情 | ✓ ✅ | ✗ ❌ | 只能通过接口获取 |
| 分时数据 | ✓ ✅ | ✗ ❌ | 只能通过接口获取 |
| **财务数据** | | | |
| 财务指标 | ✓ ✅ | ✗ ❌ | 只能通过接口获取 |
| 股本数据 | ✗ ❌ | ✓ ✅ | 文件方式更详细 |
| 除权除息 | ✓ ✅ | ✗ ❌ | 接口方式更及时 |
| **公司信息** | | | |
| 公司概况 | ✓ ✅ | ✗ ❌ | 需要通过接口分步获取 |
| 板块分类 | ✓ ✅ | ✓ ✅ | 两种方式都可获取 |
| 行业分类 | ✗ ❌ | ✗ ❌ | 需要其他数据源补充 |

---

## 四、实际测试结果分析

### 测试环境
- **测试时间**: 2025-12-15
- **连通服务器**: 180.153.18.170:7709
- **测试股票**: 000001(平安银行), 600000(浦发银行)

### 接口成功率统计

| 接口名称 | 测试状态 | 数据完整性 | 备注 |
|----------|----------|------------|------|
| get_security_bars | ✅ 成功 | 完整 | 支持多种K线周期 |
| get_index_bars | ✅ 成功 | 完整 | 包含涨跌股票统计 |
| get_security_quotes | ✅ 成功 | 完整 | 43个字段，非常详细 |
| get_security_list | ✅ 成功 | 完整 | 单次返回1000条 |
| get_security_count | ✅ 成功 | 完整 | 深圳22173，上海26392 |
| get_minute_time_data | ✅ 成功 | 完整 | 当日240条分时数据 |
| get_company_info_category | ✅ 成功 | 完整 | 16个分类文件 |
| get_company_info_content | ❌ 失败 | - | 需要特殊处理 |
| get_xdxr_info | ✅ 成功 | 完整 | 78条历史记录 |
| get_finance_info | ✅ 成功 | 完整 | 37期财务数据 |
| get_block_info | ✅ 成功 | 完整 | 板块及成分股 |

### 数据质量评估

#### 优势
1. **实时性强**: 接口方式数据更新及时
2. **数据完整**: 覆盖股票、指数、财务、板块等全方位数据
3. **字段丰富**: 实时行情包含43个字段，信息详尽
4. **历史数据**: 支长期历史数据查询

#### 限制
1. **连接依赖**: 需要稳定的网络连接
2. **频率限制**: 高频调用可能被限制
3. **文件依赖**: 文件读取方式需要通达信客户端数据
4. **部分缺失**: 行业分类等数据需要其他源补充

---

## 五、使用建议

### 1. 数据获取策略

#### 实时数据场景
- **推荐方式**: 通达信接口
- **适用场景**: 实时监控、最新行情、盘中分析
- **注意事项**: 控制调用频率，避免连接超时

#### 历史数据批量处理
- **推荐方式**: 通达信数据文件
- **适用场景**: 大量历史数据导入、回测分析
- **注意事项**: 需要通达信客户端，定期更新数据文件

#### 混合策略
```python
# 优先使用文件，失败时使用接口
def get_kline_data(code, start_date, end_date):
    try:
        # 尝试文件读取
        return file_reader.get_data(code, start_date, end_date)
    except:
        # 回退到接口调用
        return api.get_security_bars(9, market, code, 0, count)
```

### 2. 错误处理建议

#### 连接管理
```python
# 多服务器连接池
servers = [
    ("119.147.212.81", 7709),
    ("113.105.142.136", 7709),
    # ... 更多服务器
]

for server in servers:
    try:
        if api.connect(server[0], server[1]):
            break
    except:
        continue
```

#### 数据验证
```python
# 数据完整性检查
def validate_kline_data(data):
    required_fields = ['open', 'high', 'low', 'close', 'vol']
    for field in required_fields:
        if field not in data or data[field] is None:
            return False
    return True
```

### 3. 性能优化建议

#### 批量处理
- 使用`get_security_quotes`批量获取多只股票行情
- 合理设置`count`参数，平衡效率和内存

#### 缓存策略
- 基本信息可长期缓存
- 实时数据需要及时更新
- 历史K线适合本地存储

---

## 六、总结

pytdx作为通达信数据的Python接口库，提供了全面的数据采集能力：

1. **接口方式**: 适合实时数据获取，数据新鲜度高，但依赖网络连接
2. **文件方式**: 适合历史数据处理，访问速度快，但需要通达信客户端
3. **数据覆盖**: 涵盖了A股市场的主要数据需求，包括行情、财务、公司信息等
4. **使用灵活**: 支持两种方式互补使用，满足不同场景需求

在实际项目应用中，建议根据具体需求选择合适的数据获取方式，并建立完善的错误处理和数据验证机制，确保系统的稳定性和数据的准确性。

---

*本报告基于pytdx实际测试和源码分析生成，数据截至2025年12月15日*